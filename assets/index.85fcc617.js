import{r as U,bu as F,d as $,J as j,ai as r,ap as V,m as g,y as b,a6 as z,j as l,o as J,N as v,b4 as K,bv as G,ag as q,aq as A,bw as P,bx as X,z as Y,a9 as Q,l as Z}from"./vendor.3f9b7cc1.js";import{U as u,s as p,m as ee,t as te,a as ne}from"./index.3e61b258.js";import{U as He,g as ze,s as Re}from"./index.3e61b258.js";import{W as ae,a as se,e as R,K as le,b as I}from"./monaco-editor.af0454d5.js";import"./basic.9ac7729a.js";const S=U({fullscreen:!1});F(()=>S.fullscreen,e=>{e?document.body.classList.add("fullscreen"):document.body.classList.remove("fullscreen")});const oe=e=>{S.fullscreen=e},ie={state:$(S),setFullscreen:oe};self.MonacoEnvironment={getWorker(e,h){return h==="json"?new ae:new se}};const re="_universalEditor_1eh0e_5",ce="_formStatus_1eh0e_5",de="_fullScreen_1eh0e_13",ue="_container_1eh0e_25",fe="_toolbar_1eh0e_28",ge="_logo_1eh0e_37",me="_language_1eh0e_40",he="_editor_1eh0e_50",_e="_placeholder_1eh0e_54",we="_preview_1eh0e_63",be="_markdown_1eh0e_72",o={universalEditor:re,formStatus:ce,fullScreen:de,container:ue,toolbar:fe,logo:ge,language:me,editor:he,placeholder:_e,preview:we,markdown:be},ve=new Map([[u.Markdown,"md"],[u.JSON,"json"]]),Se=48,m=24,Ee=34,ye=40,ke=e=>{var M;const h=e.placeholder||"\u8BF7\u8F93\u5165\u5185\u5BB9...",_=e.value||"",E=e.eid||window.location.pathname,c=j(()=>ie),w=r.exports.useRef(null),a=r.exports.useRef(),[f,T]=r.exports.useState(!1),[d,W]=r.exports.useState(e.defaultLanguage||u.Markdown),y=()=>{const t=te(Date.now()),n=ve.get(d),s=`${E}-${t}.${n}`;ne(_,s)},x=()=>{var s,i;const t=f?.5:1,n=(s=a.current)==null?void 0:s.getLayoutInfo();(i=a.current)==null||i.layout({width:c.state.fullscreen?window.innerWidth*t:w.current.clientWidth*t,height:n.height})},C=r.exports.useCallback(()=>{var s,i,N;if(!a.current)return!1;const t=a.current.getLayoutInfo();let n=0;if(c.state.fullscreen)n=window.innerHeight-Se;else{const k=((s=e.maxRows)!=null?s:ye)*m,L=((i=e.minRows)!=null?i:Ee)*m,O=a.current.getContentHeight(),D=(N=a.current.getModel())==null?void 0:N.getLineCount();if(O)if(O>k)n=k;else{const H=D*m;H<L?n=L:n=H}}t.height!==n&&a.current.layout({width:t.width,height:n})},[c.state.fullscreen,e.maxRows,e.minRows]),B=()=>{const t=R.create(w.current,{value:_,language:d,theme:"vs-dark",tabSize:2,fontSize:14,lineHeight:m,smoothScrolling:!0,readOnly:Boolean(e.disbaled),minimap:{enabled:!e.disabledMinimap},folding:!0,contextmenu:!1,roundedSelection:!1,scrollBeyondLastLine:!1,wordBasedSuggestions:!0,acceptSuggestionOnEnter:"on",scrollbar:{alwaysConsumeMouseWheel:!1}});return t.addCommand(le.CtrlCmd|I.KeyS,y),t.addCommand(I.Escape,()=>c.setFullscreen(!1)),t};return V(()=>c.state.fullscreen,()=>C()),r.exports.useEffect(()=>{x()},[x,f]),r.exports.useEffect(()=>{var n;const t=(n=a.current)==null?void 0:n.getModel();t&&d&&R.setModelLanguage(t,d)},[d]),r.exports.useEffect(()=>{var t;(t=a.current)==null||t.updateOptions({readOnly:e.disbaled})},[e.disbaled]),r.exports.useEffect(()=>{var t,n;e.value!==((t=a.current)==null?void 0:t.getValue())&&((n=a.current)==null||n.setValue(e.value||""))},[e.value]),r.exports.useEffect(()=>{a.current=B();const t=a.current.onDidContentSizeChange(C),n=a.current.onDidChangeModelContent(()=>{var i;const s=a.current.getValue();e.disabledCacheDraft||p(E,s),s!==e.value&&((i=e.onChange)==null||i.call(e,s))});return()=>{var s,i;t.dispose(),n.dispose(),(i=(s=a.current)==null?void 0:s.dispose)==null||i.call(s)}},[]),g("div",{style:e.style,className:b(o.universalEditor,e.formStatus&&o.formStatus,c.state.fullscreen&&o.fullScreen),children:[!e.disabledToolbar&&g("div",{className:o.toolbar,children:[g(z,{className:o.left,children:[l(J.Text,{type:"secondary",strong:!0,className:o.logo,children:"UEditor"}),l(v,{size:"small",disabled:e.disbaled,icon:l(K,{}),onClick:y})]}),g(z,{className:o.right,children:[(M=e.renderToolbarExtra)==null?void 0:M.call(e,d),d===u.Markdown&&l(v,{size:"small",disabled:e.disbaled,icon:f?l(G,{}):l(q,{}),onClick:()=>T(!f)}),l(A,{size:"small",value:d,onChange:W,disabled:e.disbaled,className:o.language,options:[{label:"Markdown",value:u.Markdown},{label:"JSON",value:u.JSON}]}),l(v,{size:"small",disabled:e.disbaled,icon:c.state.fullscreen?l(P,{}):l(X,{}),onClick:()=>c.setFullscreen(!c.state.fullscreen)})]})]}),l(Y,{spinning:Boolean(e.loading),indicator:l(Q,{style:{fontSize:24},spin:!0}),children:g("div",{className:o.container,children:[l("div",{id:"container",ref:w,className:b(o.editor,!e.value&&o.placeholder),placeholder:h}),l(Z,{in:f,timeout:200,unmountOnExit:!0,classNames:"fade-fast",children:l("div",{className:b(o.preview),children:l("div",{className:o.markdown,dangerouslySetInnerHTML:{__html:ee(_)}})})})]})})]})};export{He as UEditorLanguage,ke as UniversalEditor,ze as getUEditorCache,Re as setUEditorCache};
